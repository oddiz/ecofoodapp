var UIController=function(){var e={foodAddBtn:".item__add",foodDeleteBtn:".item__delete",availableFoods:".available__food__list",selectedFoods:".selected__food__list",calculateButton:".calculate__btn",calculateAsyncButton:".withAsync",foodAmountInput:".food__amount__input",simScaleInput:".simulation__scale__input",budgetInput:".budget__amount__input",calorieInput:".calorie__amount__input",output:".output",rightContainer:".right__container",leftContainer:".left__container",calculateWorkerButton:".withWorker",progressBar:"#inner__bar",highscoreContent:".highscore__content",menuPaper:".menu__paper",stopButton:".stop__button",bottom:".bottom",infoButton:".info__button",infoContainer:".info__container",addAll:".add__all",removeAll:".remove__all",sortBar:".sort__options",quickAdd:".quick__add",priceTagInput:".item__price__input"};return{initUI:function(t){t||(t="available");var o,n=document.querySelector(e.availableFoods),i=document.querySelector(e.selectedFoods);this.clearLists(n),this.clearLists(i),o=[],Object.values(foods).forEach((function(e){Object.values(e).forEach((function(e){o.push(e)}))})),"available"===t?o.forEach((function(e){UIController.addToAvailable(e)})):"selected"===t&&o.forEach((function(e){UIController.addToSelected(e)}))},getAvailableList:function(){var e=document.querySelectorAll(".available__food__list"),t=[];return e[0].childNodes.forEach((function(e){t.push(getFoodFromID(e.id))})),t},sortAvailable:function(t){var o=this.getAvailableList();o.sort((function(e,o){var n,i;return"name"===t?(n=e[t].toUpperCase(),i=o[t].toUpperCase()):(n=o[t],i=e[t]),n<i?1:n>i?-1:0}));var n=this;this.clearLists(document.querySelector(e.availableFoods)),o.forEach((function(e){n.addToAvailable(e)}))},infoClicked:function(){var t;(t=document.querySelector(e.bottom)).classList.toggle("hide__bottom"),document.querySelector(e.infoButton).classList.toggle("clicked"),infoContainer=document.querySelector(e.infoContainer),t.classList.contains("hide__bottom")?setTimeout((function(){infoContainer.classList.toggle("visible")}),500):infoContainer.classList.toggle("visible")},getDOMStrings:function(){return e},addToSelected:function(t){var o,n=document.getElementById(t.id);n&&n.parentNode.removeChild(n),o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o='<div class="item clearfix" id="%id%"><div class="item__description">%foodname%<i><span style="font-size: 12px;">Tier: %foodtier%</span></i></div><img class="available__img" src="./resources/img/%imgid%.png"><div class="item__delete"><i class="ion-ios-close-outline item__delete--btn"></i></div><div class="item__price"><div class="item__price__container"><img src="resources/imgWebP/ptag.png"><input type="number" class="item__price__input" value="%price%"><p>$</p></div></div><div class="food__info"><div class="food__info__title"><img class="info__img" src="./resources/imgWebP/%infoimgid%.png"><h5>%name%</h5></div><div class="food__info__nutrition"><h6>Weight:<span style="color: #0092f8;">%weight%</span> kg</h6><h6>-<span style="color: #e64b17">Carbs: %carb%</span></h6><h6>-<span style="color: #cd8c11">Protein: %protein%</span></h6><h6>-<span style="color: #ffd21c">Fat: %fat%</span></h6><h6>-<span style="color: #7b9a18">Vitamins: %vit%</span></h6><h6>Calories: %calorie% kcal</h6><h6>Made in: %foodtype%</h6></div></div></div>'.replace("%id%",t.id)).replace("%foodname%",t.name)).replace("%imgid%",t.id)).replace("%foodtier%",t.tier)).replace("%infoimgid%",t.id)).replace("%name%",t.name)).replace("%weight%",t.weight)).replace("%carb%",t.carb)).replace("%protein%",t.pro)).replace("%fat%",t.fat)).replace("%vit%",t.vit)).replace("%calorie%",t.cal)).replace("%foodtype%",t.type)).replace("%price%",UIController.getCookiePrice(t.id)||t.price),document.querySelector(e.selectedFoods).insertAdjacentHTML("afterbegin",o)},removeFromSelected:function(e){var t=document.getElementById(e.id);t.parentNode.removeChild(t),this.addToAvailable(e)},addToAvailable:function(t){var o,n=document.getElementById(t.id);n&&n.parentNode.removeChild(n),o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o='<div class="item clearfix" id="%id%"><div class="item__description">%foodname%<i><span style="font-size: 12px;">Tier: %foodtier%</span></i></div><img class="available__img" src="./resources/imgWebP/%imgid%.png"><div class="item__add"><i class="ion-android-add item__add--btn"></i></div><div class="food__info"><div class="food__info__title"><img class="info__img" src="./resources/imgWebP/%infoimgid%.png"><h5>%name%</h5></div><div class="food__info__nutrition"><h6>Weight:<span style="color: #0092f8;">%weight%</span> kg</h6><h6>-<span style="color: #e64b17">Carbs: %carb%</span></h6><h6>-<span style="color: #cd8c11">Protein: %protein%</span></h6><h6>-<span style="color: #ffd21c">Fat: %fat%</span></h6><h6>-<span style="color: #7b9a18">Vitamins: %vit%</span></h6><h6>Calories: %calorie% kcal</h6><h6>Made in: %foodtype%</h6></div></div></div>'.replace("%id%",t.id)).replace("%foodname%",t.name)).replace("%imgid%",t.id)).replace("%foodtier%",t.tier)).replace("%infoimgid%",t.id)).replace("%name%",t.name)).replace("%weight%",t.weight)).replace("%carb%",t.carb)).replace("%protein%",t.pro)).replace("%fat%",t.fat)).replace("%vit%",t.vit)).replace("%calorie%",t.cal)).replace("%foodtype%",t.type),document.querySelector(e.availableFoods).insertAdjacentHTML("afterbegin",o)},clearLists:function(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)},getInput:function(){var t=/,/gm,o=document.querySelector(e.foodAmountInput).value,n=document.querySelector(e.simScaleInput).value,i=parseInt(document.querySelector(e.budgetInput).value),r=parseInt(document.querySelector(e.calorieInput).value);return 0!==i&&-1!==i||(i=1/0),0!==r&&-1!==r||(r=1/0),{foodInput:o.replace(t,""),simInput:n.replace(t,""),budgetInput:i,calorieInput:r}},displayResults:function(t){var o,n,i,r;r=0===t.foundAt?1:t.foundAt;var a='<h1>Menu</h1><div class="horizontal__line"></div><div class="menu__content"></div><div class="horizontal__line"></div><div class="menu__result"><p><strong>Daily SP:</strong>             %sp%</p><p><strong>Multiplier:</strong>    %multiplier%</p><p><strong>No:</strong>    %index% / %simcount% </p><p><strong>Price:</strong>    %price%$</p><p><strong>Calories:</strong>    %calories%</p></div>'.replace("%sp%",t.spAmount.toFixed(2)).replace("%multiplier%",t.multiplier.toFixed(2)).replace("%index%",r).replace("%simcount%",this.getInput().simInput).replace("%price%",t.totalPrice).replace("%calories%",t.totalCalorie);for(foodname in document.querySelector(e.menuPaper).innerHTML=a,o=document.querySelector(".menu__content"),i=t.resultMenu)({}).hasOwnProperty.call(i,foodname)&&(n=`<p>${i[foodname]}x   ${foodname}</p>`,o.insertAdjacentHTML("afterbegin",n));setTimeout((function(){document.querySelector(".menu__paper").classList.add("menu__visible")}),0)},setPercentage:function(t){var o=document.querySelector(e.progressBar);o.style.width=t+"%",o.textContent=t+"%"},displayHighscore:function(t){var o,n,i,r;for(foodname in n=document.querySelector(e.highscoreContent),"<p>%message%</p><br><h2>Best in category: %foodqty%</h2><p><b>Menu: </b>%menu%</p><p><b>Daily SP: </b>%SP%</p>",i="",r=t.currentHighscore[0].menu)({}).hasOwnProperty.call(r,foodname)&&(i+=`<p>${r[foodname]}x   ${foodname}</p>`);o=(o=(o=(o="<p>%message%</p><br><h2>Best in category: %foodqty%</h2><p><b>Menu: </b>%menu%</p><p><b>Daily SP: </b>%SP%</p>".replace("%message%",t.message)).replace("%menu%",i)).replace("%SP%",t.currentHighscore[0].sp)).replace("%foodqty%",t.currentHighscore[0].foodQty),n.innerHTML=o},displayHighest:function(t){var o,n,i;for(foodname in menuObject=t.menu,i="",menuObject)({}).hasOwnProperty.call(menuObject,foodname)&&(i+=`<p>${menuObject[foodname]}x   ${foodname}</p>`);n=document.querySelector(e.highscoreContent),o=(o="<p>This app, stores the best SP combinations and categorize them by food number.</p><br><h2>Highest SP across all categories so far:</h2><p><b>Menu: </b>%menu%</p><p><b>Daily SP: </b>%SP%</p>".replace("%menu%",i)).replace("%SP%",t.sp),n.innerHTML=o},getInputPrices:function(){var t=[],o=document.querySelectorAll(e.priceTagInput);return o.length>0&&o.forEach((function(e){var o=e.parentNode.parentNode.parentNode.id,n=e.value;t.push([o,n])})),t},savePrices:function(){var e=UIController.getInputPrices();e.forEach((function(e){var t=`${e[0]}=${e[1]};`;t=t.concat("expires=Fri, December 31, 9999 3:00:00 UTC; path=/"),document.cookie=t,menuController.updatePrice(e[0],e[1])})),console.log(document.cookie)},getCookiePrice:function(e){var t=e+"=",o=document.cookie;for(var n of(o=o.split(";"),console.log(o),o))if(" "===n.charAt(0)&&(n=n.substring(1)),0===n.indexOf(t))return n=n.substring(o.indexOf(t)+t.length+1),console.log(n),menuController.updatePrice(e,n),n}}}(),menuController=function(){var e=[];return{addActive:function(t){e.push(t)},removeActive:function(t){e.forEach((function(o,n){t.id===o.id&&e.splice(n,1)}))},showActive:function(){return e},clearActive:function(){e=[]},addActiveAll:function(){for(foodType in e=[],foods)for(id in foods[foodType])e.push(foods[foodType][id])},updatePrice:function(e,t){getFoodFromID(e).price=t}}}();function getFoodFromID(e){var t,o;return e>=10?(t=e.toString().slice(1),t=parseInt(t)):t=e,(o=e.toString()[0],1===(o=parseInt(o))?foods.campfire:2===o?foods.bakery:3===o?foods.kitchen:4===o?foods.cast_stove:5===o?foods.stove:void 0)[t]}var controller=function(e,t){var o;o=e.getDOMStrings();var n=function(){document.querySelector(o.availableFoods).addEventListener("click",l),document.querySelector(o.selectedFoods).addEventListener("click",s),document.querySelector(o.calculateButton).addEventListener("click",d),document.querySelector(o.infoButton).addEventListener("click",c),document.querySelector(o.removeAll).addEventListener("click",i),document.querySelector(o.quickAdd).addEventListener("click",(function(o){var n,i,r;switch(("ion-chevron-right"==o.target.classList?o.target.parentNode.parentNode.classList:o.target.classList)[0]){case"t1__add":n=1;break;case"t1_5__add":n=1.5;break;case"t2__add":n=2;break;case"t2_5__add":n=2.5;break;case"add__all":n="all";break;default:n=-1}"all"===n?a("selected"):(i=n,r=e.getAvailableList(),console.log(r),r.forEach((function(e){e.tier===i&&(t.addActive(e),UIController.addToSelected(e))})))})),document.querySelector(o.sortBar).addEventListener("click",r);new Cleave(".simulation__scale__input",{numeral:!0,numeralThousandsGroupStyle:"thousand"}),new Cleave(".food__amount__input",{numeral:!0,numeralThousandsGroupStyle:"thousand"});document.addEventListener("keyup",e.savePrices)};function i(){a("available"),document.querySelectorAll(".sort__options")[0].firstElementChild.childNodes.forEach((function(t){if(t.classList&&t.classList.contains("active")){var o=t.textContent.toLowerCase();"protein"===o?o="pro":"vitamin"===o&&(o="vit"),e.sortAvailable(o)}}))}function r(t){if(!t.target.classList||!t.target.classList.contains("active")){document.querySelectorAll(".sort__options")[0].firstElementChild.childNodes.forEach((function(e){e.classList&&e.classList.contains("active")&&e.classList.remove("active")})),t.target.classList.add("active");var o=t.target.textContent.toLowerCase();"protein"===o?o="pro":"vitamin"===o&&(o="vit"),e.sortAvailable(o)}}function a(o){"selected"===o?(t.addActiveAll(),e.initUI("selected")):"available"===o&&(t.clearActive(),e.initUI("available"))}function c(){e.infoClicked()}function l(o){var n,i;n=o.target.parentNode.parentNode.id,parseInt(n)&&(i=getFoodFromID(n),e.addToSelected(i),t.addActive(i))}function s(o){var n,i;n=o.target.parentNode.parentNode.id,parseInt(n)&&(i=getFoodFromID(n),e.removeFromSelected(i),t.removeActive(i))}function d(){document.querySelector(o.calculateButton).removeEventListener("click",d);var n,i=t.showActive(),r=e.getInput(),a=r.foodInput,c=r.simInput,l=r.budgetInput,s=r.calorieInput;if(""===a||""===c)return document.querySelector(o.calculateButton).addEventListener("click",d),void swal("Don't leave input fields blank.","","error");if(0===i.length)return document.querySelector(o.calculateButton).addEventListener("click",d),void swal("No food selected.","","error");document.querySelector(o.leftContainer).style.marginLeft="5%",document.querySelector(o.menuPaper).style.webkitFilter="blur(4px)",(n=document.querySelector(o.menuPaper))&&(n.style.tranform="translateX(0);"),console.log("Starting worker.");var u=new Worker("testMenuWorker.js");u.postMessage([i,c,a,l,s]);var p=document.querySelector(o.stopButton);function m(){u.terminate(),document.querySelector(o.calculateButton).addEventListener("click",d),p.removeEventListener("click",m),p.classList.remove("visible")}p.classList.add("visible"),p.addEventListener("click",m),u.onmessage=function(t){if("number"==typeof t.data)e.setPercentage(t.data);else if("error"===t.data)swal("No diets found with specified limits.","","error"),document.querySelector(o.menuPaper).style.webkitFilter="blur(0)",m();else{document.querySelector(o.rightContainer);setTimeout((function(){document.querySelector(o.menuPaper).style.webkitFilter="",e.displayResults(t.data)}),500),n=t.data,fetch("http://api.kaansarkaya.com:8000/highscore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(e=>e.json()).then(t=>(console.log("Request complete! response:",t),e.displayHighscore(t),t)),m()}var n}}return{init:function(){e.initUI(),n(),console.log("Application has started."),fetch("http://api.kaansarkaya.com:8000/gethighest",{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(t=>{console.log("Highest score get:"+t.sp),e.displayHighest(t)})}}}(UIController,menuController);controller.init();